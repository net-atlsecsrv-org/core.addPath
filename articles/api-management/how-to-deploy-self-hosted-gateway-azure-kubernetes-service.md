---
title: Deploy a self-hosted gateway to Azure Kubernetes Service | Microsoft Docs
description: Learn how to deploy self-hosted gateway component of Azure API Management to Azure Kubernetes Service
services: api-management
documentationcenter: ''
author: miaojiang
manager: gwallace
editor: ''

ms.service: api-management

ms.topic: article
ms.date: 04/26/2020
ms.author: apimpm

---

# Deploy to Azure Kubernetes Service

This article provides the steps for deploying self-hosted gateway component of Azure API Management to [Azure Kubernetes Service](https://azure.microsoft.com/services/kubernetes-service/). For deploying self-hosted gateway to a Kubernetes cluster see this[document](how-to-deploy-self-hosted-gateway-kubernetes.md).

## Prerequisites

- [Create an Azure API Management instance](get-started-create-service-instance.md)
- [Create an Azure Kubernetes cluster](../aks/kubernetes-walkthrough-portal.md)
- [Provision a gateway resource in your API Management instance](api-management-howto-provision-self-hosted-gateway.md).

## Deploy the self-hosted gateway to AKS

1. Select **Gateways** from under **Deployment and infrastructure**.
2. Select the self-hosted gateway resource you intend to deploy.
3. Select **Deployment**.
4. Note that a new token in the **Token** text box was autogenerated for you using the default **Expiry** and **Secret Key** values. Adjust either or both if desired and select **Generate** to create a new token.
5. Make sure **Kubernetes** is selected under **Deployment scripts**.
6. Select **<gateway-name>.yml** file link next to **Deployment** to download the file.
7. Adjust the port mappings and container name in the yml file as needed.
8. Depending on your scenario, you might need to change the [service type](../aks/concepts-network.md#services). The default value is `NodePort`.
9. Select the **copy** icon located at the right end of the **Deploy** text box to save the `kubectl` command to clipboard.
10. Paste the command to the terminal (or command) window. Note that the command expects the downloaded environment file to be present in the current directory.
```console
    kubectl apply -f <gateway-name>.yaml
```
11. Execute the command. The command instructs your AKS cluster to run the container, using self-hosted gateway's image downloaded from the Microsoft Container Registry, and to configure the container to expose HTTP (8080) and HTTPS (443) ports.
12. Run the below command to check the gateway pod is running. Note that your pod name will be different.
```console
kubectl get pods
NAME                                   READY     STATUS    RESTARTS   AGE
contoso-apim-gateway-59f5fb94c-s9stz   1/1       Running   0          1m
```
13. Run the below command to check the gateway service is running. Note that your service name and IP addresses will be different.
```console
kubectl get services
NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
contosogateway   NodePort    10.110.230.87   <none>        80:32504/TCP,443:30043/TCP   1m
```
14. Go back to the Azure portal and confirm that gateway node you just deployed is reporting healthy status.

> [!TIP]
> Use <code>kubectl logs <gateway-pod-name></code> command to view a snapshot of self-hosted gateway log.

## Next steps

* To learn more about the self-hosted gateway, see [Azure API Management self-hosted gateway overview](self-hosted-gateway-overview.md)
* Learn more about [Azure Kubernetes Service](../aks/intro-kubernetes.md)
* Learn [how to configure and persist logs in the cloud](how-to-configure-cloud-metrics-logs.md)
* * Learn [how to configure and persist logs locally](how-to-configure-local-metrics-logs.md)
