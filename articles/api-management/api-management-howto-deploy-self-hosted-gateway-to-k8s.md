---
title: Deploy a self-hosted Azure API Management gateway to Kubernetes | Microsoft Docs
description: Learn how to deploy a self-hosted Azure API Management gateway to Kubernetes
services: api-management
documentationcenter: ''
author: miaojiang
manager: gwallace
editor: ''

ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 10/31/2019
ms.author: apimpm

---

# Deploy a self-hosted Azure API Management gateway to Kubernetes

This article provides the steps for deploying self-hosted Azure API Management gateway into a Kubernetes Cluster.

> [!NOTE]
> Self-hosted gateway feature is in preview. During the preview, the self-hosted gateway is available only in the Developer and Premium tiers at no additional charge. Developer tier is limited to a single self-hosted gateway deployment.


## Prerequisites

- Complete the following quickstart: [Create an Azure API Management instance](get-started-create-service-instance.md)
- Create a Kubernetes cluster. [Minikube](https://kubernetes.io/docs/tasks/tools/install-minikube/) is a good option for development and evaluation purposes. For production workloads, you can use [Azure Kubernetes Service](https://azure.microsoft.com/services/kubernetes-service/) or a Kubernetes cluster in a foreign cloud.
- [Provision a gateway resource in your API Management instance](api-management-howto-provision-self-hosted-gateway.md).

## Deploy the gateway to Kubernetes

1. Select **Gateways** from under **Settings**.
2. Select the gateway resource you intend to deploy.
3. Select **Deployment**.
4. Note that a new token in the **Token** text box was autogenerated for you using the default **Expiry** and **Secret Key** values. Adjust either or both if desired and select **Generate** to create a new token.
5. Make sure **Kubernetes** is selected under **Deployment scripts**.
6. Select **<gateway-name>.yml** file link next to **Deployment** to download the file.
7. Adjust the port mappings and container name in the yml file as needed.
8. Select the **copy** icon located at the right end of the **Deploy** text box to save the `kubectl` command to clipboard. 
9. Paste the command to the terminal (or command) window. Note that the command expects the downloaded environment file to be present in the current directory.
```console
    kubectl apply -f <gateway-name>.yaml
```
10. Execute the command. The command instructs your Kubernetes cluster to run the container, using self-hosted gateway's image downloaded from the Microsoft Container Registry, and to configure the container to expose HTTP (8080) and HTTPS (443) ports.
11. Run the below command to check the gateway pod is running. Note that your pod name will be different. 
```console
kubectl get pods
NAME                              READY   STATUS    RESTARTS   AGE
local-gateway-55f774f844-bv9wt    1/1     Running   0          1m
```
12. Run the below command to check the gateway service is running. Note that your service name will be different. 
```console
kubectl get services
NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
localgateway     NodePort    10.110.230.87   <none>        80:32504/TCP,443:30043/TCP   1m
```
13. Go back to the Azure portal and confirm that gateway node you just deployed is reporting healthy status.

![gateway status](media/api-management-howto-deploy-self-hosted-gateway-to-k8s/status.png)

> [!TIP]
> Use <code>kubectl logs <gateway-pod-name></code> command to view a snapshot of self-hosted gateway log.

## Next steps

* To learn more about the self-hosted gateway, see [Azure API Management self-hosted gateway overview](self-hosted-gateway-overview.md)
* Learn more about [Azure Kubernetes Service](https://docs.microsoft.com/azure/aks/intro-kubernetes)


