---
title: Using AppAuth in an iOS application in Azure Active Directory B2C | Microsoft Docs
description: This article shows you how to create an iOS app that uses AppAuth with Azure Active Directory B2C to manage user identities and authenticate users.
services: active-directory-b2c
author: mmacy
manager: celestedg

ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 11/30/2018
ms.author: marsma
ms.subservice: B2C
---

# Azure AD B2C: Sign-in using an iOS application

The Microsoft identity platform uses open standards such as OAuth2 and OpenID Connect. Using an open standard protocol offers more developer choice when selecting a library to integrate with our services. We've provided this walkthrough and others like it to aid developers with writing applications that connect to the Microsoft Identity platform. Most libraries that implement [the RFC6749 OAuth2 spec](https://tools.ietf.org/html/rfc6749) are able to connect to the Microsoft Identity platform.

> [!WARNING]
> Microsoft does not provide fixes for third-party libraries and has not done a review of those libraries. This sample is using a third-party library called AppAuth that has been tested for compatibility in basic scenarios with the Azure AD B2C. Issues and feature requests should be directed to the library's open-source project. For more information, see [this article](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-libraries).
>
>

If you're new to OAuth2 or OpenID Connect, much of this sample configuration may not make much sense to you. We recommend you look at a brief [overview of the protocol we've documented here](active-directory-b2c-reference-protocols.md).

## Get an Azure AD B2C directory
Before you can use Azure AD B2C, you must create a directory, or tenant. A directory is a container for all your users, apps, groups, and more. If you don't have one already, [create a B2C directory](tutorial-create-tenant.md) before you continue.

## Create an application

Next, register an application in your Azure AD B2C tenant. This gives Azure AD the information it needs to communicate securely with your app.

[!INCLUDE [active-directory-b2c-appreg-native](../../includes/active-directory-b2c-appreg-native.md)]

Record the **APPLICATION ID** for use in a later step. Next, select the application in the list and record the **Custom Redirect URI**, also for use in a later step. For example, `com.onmicrosoft.contosob2c.exampleapp://oauth/redirect`.

## Create your user flows
In Azure AD B2C, every user experience is defined by a [user flow](active-directory-b2c-reference-policies.md). This application contains one identity experience: a combined sign-in and sign-up. When you create the user flow, be sure to:

* Under **Sign-up attributes**, select the attribute **Display name**.  You can select other attributes as well.
* Under **Application claims**, select the claims **Display name** and **User's Object ID**. You can select other claims as well.
* Copy the **Name** of each user flow after you create it. Your user flow name is prefixed with `b2c_1_` when you save the user flow.  You need the user flow name later.

After you have created your user flows, you're ready to build your app.

## Download the sample code
We have provided a working sample that uses AppAuth with Azure AD B2C [on GitHub](https://github.com/Azure-Samples/active-directory-ios-native-appauth-b2c). You can download the code and run it. To use your own Azure AD B2C tenant, follow the instructions in the [README.md](https://github.com/Azure-Samples/active-directory-ios-native-appauth-b2c/blob/master/README.md).

This sample was created by following the README instructions by the [iOS AppAuth project on GitHub](https://github.com/openid/AppAuth-iOS). For more details on how the sample and the library work, reference the AppAuth README on GitHub.

## Modifying your app to use Azure AD B2C with AppAuth

> [!NOTE]
> AppAuth supports iOS 7 and above.  However, to support social logins on Google, SFSafariViewController is needed which requires iOS 9 or higher.
>

### Configuration

You can configure communication with Azure AD B2C by specifying both the authorization endpoint and token endpoint URIs.  To generate these URIs, you need the following information:
* Tenant ID (for example, contoso.onmicrosoft.com)
* User flow name (for example, B2C\_1\_SignUpIn)

The token endpoint URI can be generated by replacing the Tenant\_ID and the Policy\_Name in the following URL:

```objc
static NSString *const tokenEndpoint = @"https://<Tenant_name>.b2clogin.com/te/<Tenant_ID>/<Policy_Name>/oauth2/v2.0/token";
```

The authorization endpoint URI can be generated by replacing the Tenant\_ID and the Policy\_Name in the following URL:

```objc
static NSString *const authorizationEndpoint = @"https://<Tenant_name>.b2clogin.com/te/<Tenant_ID>/<Policy_Name>/oauth2/v2.0/authorize";
```

Run the following code to create your AuthorizationServiceConfiguration object:

```objc
OIDServiceConfiguration *configuration =
    [[OIDServiceConfiguration alloc] initWithAuthorizationEndpoint:authorizationEndpoint tokenEndpoint:tokenEndpoint];
// now we are ready to perform the auth request...
```

### Authorizing

After configuring or retrieving an authorization service configuration, an authorization request can be constructed. To create the request, you need the following information:

* Client ID (APPLICATION ID) that you recorded earlier. For example, `00000000-0000-0000-0000-000000000000`.
* Custom Redirect URI that you recorded earlier. For example, `com.onmicrosoft.contosob2c.exampleapp://oauth/redirect`.

Both items should have been saved when you were [registering your app](#create-an-application).

```objc
OIDAuthorizationRequest *request =
    [[OIDAuthorizationRequest alloc] initWithConfiguration:configuration
                                                  clientId:kClientId
                                                    scopes:@[OIDScopeOpenID, OIDScopeProfile]
                                               redirectURL:[NSURL URLWithString:kRedirectUri]
                                              responseType:OIDResponseTypeCode
                                      additionalParameters:nil];

AppDelegate *appDelegate = (AppDelegate *)[UIApplication sharedApplication].delegate;
appDelegate.currentAuthorizationFlow =
    [OIDAuthState authStateByPresentingAuthorizationRequest:request
                                   presentingViewController:self
                                                   callback:^(OIDAuthState *_Nullable authState, NSError *_Nullable error) {
        if (authState) {
            NSLog(@"Got authorization tokens. Access token: %@", authState.lastTokenResponse.accessToken);
            [self setAuthState:authState];
        } else {
            NSLog(@"Authorization error: %@", [error localizedDescription]);
            [self setAuthState:nil];
        }
    }];
```

To set up your application to handle the redirect to the URI with the custom scheme, you need to update the list of 'URL Schemes' in your Info.pList:
* Open Info.pList.
* Hover over a row like 'Bundle OS Type Code' and click the \+ symbol.
* Rename the new row 'URL types'.
* Click the arrow to the left of 'URL types' to open the tree.
* Click the arrow to the left of 'Item 0' to open the tree.
* Rename first item underneath Item 0 to 'URL Schemes'.
* Click the arrow to the left of 'URL Schemes' to open the tree.
* In the 'Value' column, there is a blank field to the left of 'Item 0' underneath 'URL Schemes'.  Set the value to your application's unique scheme.  The value must match the scheme used in redirectURL when creating the OIDAuthorizationRequest object.  In the sample,  the scheme 'com.onmicrosoft.fabrikamb2c.exampleapp' is used.

Refer to the [AppAuth guide](https://openid.github.io/AppAuth-iOS/) on how to complete the rest of the process. If you need to quickly get started with a working app, check out [the sample](https://github.com/Azure-Samples/active-directory-ios-native-appauth-b2c). Follow the steps in the [README.md](https://github.com/Azure-Samples/active-directory-ios-native-appauth-b2c/blob/master/README.md) to enter your own Azure AD B2C configuration.

We are always open to feedback and suggestions! If you have any difficulties with this article, or have recommendations for improving this content, we would appreciate your feedback at the bottom of the page. For feature requests, add them to [UserVoice](https://feedback.azure.com/forums/169401-azure-active-directory/category/160596-b2c).
