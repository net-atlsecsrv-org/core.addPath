---
# Mandatory fields.
title: Manage endpoints and routes (portal)
titleSuffix: Azure Digital Twins
description: See how to set up and manage endpoints and event routes for Azure Digital Twins data using the Azure portal.
author: baanders
ms.author: baanders # Microsoft employees only
ms.date: 7/22/2020
ms.topic: how-to
ms.service: digital-twins

# Optional fields. Don't forget to remove # if you need a field.
# ms.custom: can-be-multiple-comma-separated
# ms.reviewer: MSFT-alias-of-reviewer
# manager: MSFT-alias-of-manager-or-PM-counterpart
---

# Manage endpoints and routes in Azure Digital Twins (portal)

[!INCLUDE [digital-twins-route-selector.md](../../includes/digital-twins-route-selector.md)]

In Azure Digital Twins, you can route [event notifications](how-to-interpret-event-data.md) to downstream services or connected compute resources. This is done by first setting up **endpoints** that can receive the events. You can then create [**event routes**](concepts-route-events.md) that specify which events generated by Azure Digital Twins are delivered to which endpoints.

This article walks you through the process of creating endpoints and routes using the [Azure portal](https://portal.azure.com).

Alternatively, you can also manage endpoints and routes with the [Event Routes APIs](/rest/api/digital-twins/dataplane/eventroutes), the [SDKs](how-to-use-apis-sdks.md#overview-data-plane-apis), or the [Azure Digital Twins CLI](how-to-use-cli.md). For a version of this article that uses these mechanisms instead of the portal, see [*How-to: Manage endpoints and routes (APIs and CLI)*](how-to-manage-routes-apis-cli.md).

## Prerequisites

* You'll need an **Azure account** (you can set one up for free [here](https://azure.microsoft.com/free/?WT.mc_id=A261C142F))
* You'll need an **Azure Digital Twins instance** in your Azure subscription. If you don't have an instance already, you can create one using the steps in [*How-to: Set up an instance and authentication*](how-to-set-up-instance-portal.md). Have the following values from setup handy to use later in this article:
    - Instance name
    - Resource group

You can find these details in the [Azure portal](https://portal.azure.com) after setting up your instance. Log into the portal and search for the name of your instance in the portal search bar.
 
:::image type="content" source="media/how-to-manage-routes-portal/search-field-portal.png" alt-text="Screenshot of Azure portal search bar." lightbox="media/how-to-manage-routes-portal/search-field-portal.png":::

Select your instance from the results to see these details in the Overview for your instance:

:::image type="content" source="media/how-to-manage-routes-portal/instance-details.png" alt-text="Screenshot of the Overview page for an Azure Digital Twins instance. The name and resource group are highlighted.":::

## Create an endpoint for Azure Digital Twins

These are the supported types of endpoints that you can create for your instance:
* [Event Grid](../event-grid/overview.md) 
* [Event Hubs](../event-hubs/event-hubs-about.md)
* [Service Bus](../service-bus-messaging/service-bus-messaging-overview.md)

For more information on the different endpoint types, see [*Choose between Azure messaging services*](../event-grid/compare-messaging-services.md).

This section explains how to create one of these endpoints in the [Azure portal](https://portal.azure.com).

[!INCLUDE [digital-twins-endpoint-resources.md](../../includes/digital-twins-endpoint-resources.md)]

### Create the endpoint 

Once you have created the endpoint resources, you can use them for an Azure Digital Twins endpoint. To create a new endpoint, go to your instance's page in the [Azure portal](https://portal.azure.com) (you can find the instance by entering its name into the portal search bar).

1. From the instance menu, select _Endpoints_. Then from the *Endpoints* page that follows, select *+ Create an endpoint*. This will open the *Create an endpoint* page, where you'll fill in the fields in the following steps.

    :::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-event-grid.png" alt-text="Screenshot of creating an endpoint of type Event Grid." lightbox="media/how-to-manage-routes-portal/create-endpoint-event-grid.png":::

1. Enter a **Name** for your endpoint and choose the **Endpoint type**.

1. Complete the other details that are required for your endpoint type, including your subscription and the endpoint resources described [above](#prerequisite-create-endpoint-resources).
    1. For Event Hub and Service Bus endpoints only, you must select an **Authentication type**. You can use key-based authentication with a pre-created authorization rule, or identity-based authentication if you'll be using the endpoint with a [managed identity](concepts-security.md#managed-identity-for-accessing-other-resources-preview) for your Azure Digital Twins instance. 

    :::row:::
        :::column:::
            :::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-event-hub-authentication.png" alt-text="Screenshot of creating an endpoint of type Event Hub." lightbox="media/how-to-manage-routes-portal/create-endpoint-event-hub-authentication.png":::
        :::column-end:::
        :::column:::
        :::column-end:::
    :::row-end:::

1. Finish creating your endpoint by selecting _Save_.

>[!IMPORTANT]
> In order to successfully use identity-based authentication for your endpoint, you'll need to create a managed identity for your instance by following the steps in [*How-to: Enable a managed identity for routing events (preview)*](./how-to-enable-managed-identities-portal.md).

After creating your endpoint, you can verify that the endpoint was successfully created by checking the notification icon in the top Azure portal bar: 

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-notifications.png" alt-text="Screenshot of notification to verify the creation of endpoint. The bell-shaped icon from the portal's top bar is selected, and there is a notification saying 'Endpoint ADT-eh-endpoint successfully created'.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

If the endpoint creation fails, observe the error message and retry after a few minutes.

You can also view the endpoint that was created back on the *Endpoints* page for your Azure Digital Twins instance.

Now the event grid, event hub, or Service Bus topic is available as an endpoint inside of Azure Digital Twins, under the name you chose for the endpoint. You'll typically use that name as the target of an **event route**, which you'll create [later in this article](#create-an-event-route).

### Create an endpoint with dead-lettering

When an endpoint can't deliver an event within a certain time period or after trying to deliver the event a certain number of times, it can send the undelivered event to a storage account. This process is known as **dead-lettering**.

In order to create an endpoint with dead-lettering enabled, you must use the [CLI commands](how-to-use-cli.md) or [control plane APIs](/rest/api/digital-twins/controlplane/endpoints/digitaltwinsendpoint_createorupdate) to create your endpoint, rather than the Azure portal.

For instructions on how to do this with these tools, see the [*APIs and CLI*](how-to-manage-routes-apis-cli.md#create-an-endpoint-with-dead-lettering) version of this article.

## Create an event route

To actually send data from Azure Digital Twins to an endpoint, you'll need to define an **event route**. These routes let developers wire up event flow, throughout the system and to downstream services. Read more about event routes in [*Concepts: Routing Azure Digital Twins events*](concepts-route-events.md).

**Prerequisite**: You need to create endpoints as described earlier in this article before you can move on to creating a route. You can proceed to creating an event route once your endpoints are finished setting up.

>[!NOTE]
>If you have recently deployed your endpoints, validate that they're finished deploying **before** attempting to use them for a new event route. If you're unable to set up the route because the endpoints aren't ready, wait a few minutes and try again.

### Creation steps with the Azure portal

An event route definition contains these elements:
* The route name you want to use
* The name of the endpoint you want to use
* A filter that defines which events are sent to the endpoint
    - To disable the route so that no events are sent, use a filter value of `false`
    - To enable a route that has no specific filtering, use a filter value of `true`
    - For details on any other type of filter, see the [*Filter events*](#filter-events) section below.

A single route can allow multiple notifications and event types to be selected.

To create an event route, go to the details page for your Azure Digital Twins instance in the [Azure portal](https://portal.azure.com) (you can find the instance by entering its name into the portal search bar).

From the instance menu, select _Event routes_. Then from the *Event routes* page that follows, select *+ Create an event route*. 

On the *Create an event route* page that opens up, choose at minimum:
* A name for your route in the _Name_ field
* The _Endpoint_ you would like to use to create the route 

For the route to be enabled, you must also **Add an event route filter** of at least `true`. (Leaving the default value of `false` will create the route, but no events will be sent to it.) To do this, toggle the switch for the _Advanced editor_ to enable it, and write `true` in the *Filter* box.

:::image type="content" source="media/how-to-manage-routes-portal/create-event-route-no-filter.png" alt-text="Screenshot of creating event route for your instance." lightbox="media/how-to-manage-routes-portal/create-event-route-no-filter.png":::

When finished, hit the _Save_ button to create your event route.

## Filter events

As described above, routes have a **filter** field. If the filter value on your route is `false`, no events will be sent to your endpoint. 

After enabling the minimal filter of `true`, endpoints will receive a variety of events from Azure Digital Twins:
* Telemetry fired by [digital twins](concepts-twins-graph.md) using the Azure Digital Twins service API
* Twin property change notifications, fired on property changes for any twin in the Azure Digital Twins instance
* Life-cycle events, fired when twins or relationships are created or deleted

You can restrict the types of events being sent by defining a more-specific filter.

To add an event filter while you are creating an event route, use the _Add an event route filter_ section of the *Create an event route* page. 

You can either select from some basic common filter options, or use the advanced filter options to write your own custom filters.

>[!NOTE]
> Filters are **case-sensitive** and need to match the payload case. 
>
> For telemetry filters, this means that the casing needs to match the casing in the telemetry sent by the device, not necessarily the casing defined in the twin's model.

#### Use the basic filters

To use the basic filters, expand the _Event types_ option and select the checkboxes corresponding to the events you'd like to send to your endpoint. 

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-basic-1.png" alt-text="Screenshot of creating an event route with a basic filter. Selecting the checkboxes of the events.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

This will auto-populate the filter text box with the text of the filter you've selected:

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-basic-2.png" alt-text="Screenshot of creating an event route with a basic filter. Showing the auto-populated filter text after selecting the events.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

#### Use the advanced filters

Alternatively, you can use the advanced filter option to write your own custom filters.

To create an event route with advanced filter options, toggle the switch for the _Advanced editor_ to enable it. You can then write your own event filters in the *Filter* box:

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-advanced.png" alt-text="Screenshot of creating an event route with an advanced filter.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

Here are the supported route filters. The detail in the *Filter text schema* column is the text that can be entered into the filter box.

[!INCLUDE [digital-twins-route-filters](../../includes/digital-twins-route-filters.md)]

[!INCLUDE [digital-twins-route-metrics](../../includes/digital-twins-route-metrics.md)]

## Next steps

Read about the different types of event messages you can receive:
* [*How-to: Interpret event data*](how-to-interpret-event-data.md)