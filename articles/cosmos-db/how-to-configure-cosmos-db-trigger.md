---
title: Azure Functions trigger for Cosmos DB advanced configuration
description: Learn how to configure logging and connection policy used by Azure Functions trigger for Cosmos DB
author: ealsur
ms.service: cosmos-db
ms.topic: how-to
ms.date: 10/19/2020
ms.author: maquaran
---

# How to configure logging and connectivity with the Azure Functions trigger for Cosmos DB
[!INCLUDE[appliesto-sql-api](includes/appliesto-sql-api.md)]

This article describes advanced configuration options you can set when using the Azure Functions trigger for Cosmos DB.

## Enabling trigger specific logs

The Azure Functions trigger for Cosmos DB uses the [Change Feed Processor Library](./change-feed-processor.md) internally, and the library generates a set of health logs that can be used to monitor internal operations for [troubleshooting purposes](./troubleshoot-changefeed-functions.md).

The health logs describe how the Azure Functions trigger for Cosmos DB behaves when attempting operations during load-balancing scenarios or initialization.

### Enabling logging

To enable logging when using Azure Functions trigger for Cosmos DB, locate the `host.json` file in your Azure Functions project or Azure Functions App and [configure the level of required logging](../azure-functions/functions-monitoring.md#log-levels-and-categories). Enable the traces for  `Host.Triggers.CosmosDB` as shown in the following sample:

```js
{
  "version": "2.0",
  "logging": {
    "fileLoggingMode": "always",
    "logLevel": {
      "Host.Triggers.CosmosDB": "Trace"
    }
  }
}
```

After the Azure Function is deployed with the updated configuration, you will see the Azure Functions trigger for Cosmos DB logs as part of your traces. You can view the logs in your configured logging provider under the *Category* `Host.Triggers.CosmosDB`.

### Query the logs

Run the following query to query the logs generated by the Azure Functions trigger for Cosmos DB in [Azure Application Insights' Analytics](../azure-monitor/log-query/log-query-overview.md):

```sql
traces
| where customDimensions.Category == "Host.Triggers.CosmosDB"
```

## Configuring the connection policy

There are two connection modes - Direct mode and Gateway mode. To learn more about these connection modes, see the [connection modes](sql-sdk-connection-modes.md) article. By default, **Gateway** is used to establish all connections on the Azure Functions trigger for Cosmos DB. However, it might not be the best option for performance-driven scenarios.

### Changing the connection mode and protocol

There are two key configuration settings available to configure the client connection policy â€“ the **connection mode** and the **connection protocol**. You can change the default connection mode and protocol used by the Azure Functions trigger for Cosmos DB and all the [Azure Cosmos DB bindings](../azure-functions/functions-bindings-cosmosdb-v2-output.md)). To change the default settings, you need to locate the `host.json` file in your Azure Functions project or Azure Functions App and add the following [extra setting](../azure-functions/functions-bindings-cosmosdb-v2-output.md#hostjson-settings):

```js
{
  "cosmosDB": {
    "connectionMode": "Direct",
    "protocol": "Tcp"
  }
}
```

Where `connectionMode` must have the desired connection mode (Direct or Gateway) and `protocol` the desired connection protocol (Tcp or Https). 

If your Azure Functions project is working with Azure Functions V1 runtime, the configuration has a slight name difference, you should use `documentDB` instead of `cosmosDB`:

```js
{
  "documentDB": {
    "connectionMode": "Direct",
    "protocol": "Tcp"
  }
}
```

> [!NOTE]
> When working with Azure Functions Consumption Plan Hosting plan, each instance has a limit in the amount of Socket Connections that it can maintain. When working with Direct / TCP mode, by design more connections are created and can hit the [Consumption Plan limit](../azure-functions/manage-connections.md#connection-limit), in which case you can either use Gateway mode or run your Azure Functions in [App Service Mode](../azure-functions/functions-scale.md#app-service-plan).

## Next steps

* [Connection limits in Azure Functions](../azure-functions/manage-connections.md#connection-limit)
* [Enable monitoring](../azure-functions/functions-monitoring.md) in your Azure Functions applications.
* Learn how to [Diagnose and troubleshoot common issues](./troubleshoot-changefeed-functions.md) when using the Azure Functions trigger for Cosmos DB.